<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.web.WebView?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="ecorayen.controllers.AddChallengeController"
            prefHeight="700.0" prefWidth="800.0" stylesheets="@../styles/add-challenge-styles.css">

    <top>
        <VBox alignment="CENTER" styleClass="header-container">
            <padding>
                <Insets top="15.0" bottom="15.0"/>
            </padding>
            <children>
                <Label text="Create New Challenge" styleClass="label-header"/>
            </children>
        </VBox>
    </top>

    <center>
        <ScrollPane fitToWidth="true" styleClass="scroll-pane">
            <content>
                <GridPane alignment="CENTER" hgap="15" vgap="15" styleClass="form-grid">
                    <padding>
                        <Insets bottom="30.0" left="30.0" right="30.0" top="30.0"/>
                    </padding>

                    <columnConstraints>
                        <ColumnConstraints hgrow="SOMETIMES" minWidth="100.0" prefWidth="150.0"/>
                        <ColumnConstraints hgrow="SOMETIMES" minWidth="200.0" prefWidth="400.0"/>
                    </columnConstraints>

                    <rowConstraints>
                        <RowConstraints minHeight="35.0" prefHeight="40.0" vgrow="SOMETIMES"/>
                        <RowConstraints minHeight="35.0" prefHeight="40.0" vgrow="SOMETIMES"/>
                        <RowConstraints minHeight="35.0" prefHeight="40.0" vgrow="SOMETIMES"/>
                        <RowConstraints minHeight="35.0" prefHeight="40.0" vgrow="SOMETIMES"/>
                        <RowConstraints minHeight="35.0" prefHeight="40.0" vgrow="SOMETIMES"/>
                        <RowConstraints minHeight="100.0" prefHeight="100.0" vgrow="SOMETIMES"/>
                        <RowConstraints minHeight="180.0" prefHeight="250.0" vgrow="SOMETIMES"/>
                        <RowConstraints minHeight="35.0" prefHeight="40.0" vgrow="SOMETIMES"/>
                        <RowConstraints minHeight="35.0" prefHeight="40.0" vgrow="SOMETIMES"/>
                    </rowConstraints>

                    <children>
                        <!-- Name Field -->
                        <Label text="Name:" styleClass="label-field"/>
                        <TextField fx:id="nameField" promptText="Enter challenge name"
                                   GridPane.columnIndex="1" styleClass="text-field"/>

                        <!-- Description Field with Generate Button -->
                        <Label text="Description:" GridPane.rowIndex="1" styleClass="label-field"/>
                        <HBox alignment="CENTER_LEFT" spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <TextArea fx:id="descriptionField" promptText="Brief challenge description"
                                      wrapText="true" prefHeight="60" prefRowCount="3" styleClass="text-area"/>
                            <VBox spacing="5" alignment="CENTER">
                                <Button fx:id="generateDescButton" text="Generate"
                                        onAction="#handleGenerateDescription" styleClass="button--secondary"/>
                                <ProgressIndicator fx:id="progressIndicator" visible="false"
                                                   prefWidth="20" prefHeight="20"/>
                            </VBox>
                        </HBox>

                        <!-- Date Pickers -->
                        <Label text="Start Date:" GridPane.rowIndex="2" styleClass="label-field"/>
                        <DatePicker fx:id="dateStartPicker" GridPane.columnIndex="1"
                                    GridPane.rowIndex="2" styleClass="date-picker"/>

                        <Label text="End Date:" GridPane.rowIndex="3" styleClass="label-field"/>
                        <DatePicker fx:id="dateEndPicker" GridPane.columnIndex="1"
                                    GridPane.rowIndex="3" styleClass="date-picker"/>

                        <!-- Location Field -->
                        <Label text="Location:" GridPane.rowIndex="4" styleClass="label-field"/>
                        <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="4">
                            <TextField fx:id="locationField" promptText="Enter location"
                                       styleClass="text-field" HBox.hgrow="ALWAYS"/>
                        </HBox>

                        <!-- Location Data Container -->
                        <Label text="Location Details:" GridPane.rowIndex="5" styleClass="label-field"/>
                        <VBox fx:id="locationContainer" spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="5"
                              styleClass="location-container">
                            <Label fx:id="coordinatesLabel" text="Coordinates: Not set" styleClass="location-data"/>
                            <Label fx:id="addressLabel" text="Address: Not available" styleClass="location-data"/>
                        </VBox>

                        <!-- Map View with Zoom Controls -->
                        <Label text="Map Preview:" GridPane.rowIndex="6" styleClass="label-field"/>
                        <VBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="6">
                            <HBox spacing="5" alignment="CENTER_RIGHT">
                                <Button fx:id="zoomInButton" text="+"
                                        onAction="#handleZoomIn" styleClass="button--small"/>
                                <Button fx:id="zoomOutButton" text="-"
                                        onAction="#handleZoomOut" styleClass="button--small"/>
                            </HBox>
                            <WebView fx:id="mapView" prefHeight="250" styleClass="web-view"/>
                        </VBox>

                        <!-- Image Field with Browse Button -->
                        <Label text="Image:" GridPane.rowIndex="7" styleClass="label-field"/>
                        <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="7">
                            <TextField fx:id="imagePathField" promptText="Image path"
                                       styleClass="text-field" HBox.hgrow="ALWAYS"/>
                            <Button text="Browse" onAction="#handleBrowseImage" styleClass="button"/>
                        </HBox>

                        <!-- Action Buttons -->
                        <HBox alignment="CENTER" spacing="20" GridPane.columnIndex="1" GridPane.rowIndex="8">
                            <Button text="Save" onAction="#handleAddChallenge" styleClass="button--primary" prefWidth="100"/>
                            <Button text="Cancel" onAction="#handleCancel" styleClass="button--danger" prefWidth="100"/>
                        </HBox>
                    </children>
                </GridPane>
            </content>
        </ScrollPane>
    </center>
</BorderPane>